<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Reuniones ¬∑ Zona Horaria</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Charm:wght@700&family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --blue:        #002283;
    --blue-dark:   #001860;
    --blue-light:  #eaedfa;
    --green:       #00E0AC;
    --green-dark:  #00b88a;
    --green-light: #e0fdf6;
    --white:       #ffffff;
    --bg:          #f4f6fb;
    --ink:         #001240;
    --muted:       #6b7a9e;
    --border:      #d4d9ec;
    --surface:     #ffffff;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: 'DM Sans', sans-serif; background: var(--bg); color: var(--ink); min-height: 100vh; }
  .font-brand { font-family: 'DM Sans', sans-serif; font-weight: 700; letter-spacing: -0.01em; }
  .font-secondary { font-family: 'Charm', cursive; }

  .card { background: var(--surface); border: 1px solid var(--border); border-radius: 18px; box-shadow: 0 2px 20px rgba(0,34,131,0.06); }

  input, select {
    font-family: 'DM Sans', sans-serif; font-size: 14px;
    border: 1.5px solid var(--border); border-radius: 10px;
    padding: 10px 14px; width: 100%; background: var(--bg);
    color: var(--ink); outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
  }
  input:focus, select:focus { border-color: var(--green); box-shadow: 0 0 0 3px rgba(0,224,172,0.18); }
  label { font-size: 11px; font-weight: 700; letter-spacing: 0.08em; text-transform: uppercase; color: var(--muted); display: block; margin-bottom: 6px; }

  .btn-primary {
    background: var(--green); color: var(--blue); border: none; border-radius: 10px;
    padding: 11px 24px; font-family: 'DM Sans', sans-serif; font-size: 14px; font-weight: 700;
    cursor: pointer; transition: background 0.15s, transform 0.1s, box-shadow 0.15s;
    box-shadow: 0 2px 12px rgba(0,224,172,0.3);
  }
  .btn-primary:hover { background: var(--green-dark); box-shadow: 0 4px 18px rgba(0,224,172,0.4); }
  .btn-primary:active { transform: scale(0.98); }

  .btn-ghost {
    background: transparent; color: var(--muted); border: 1.5px solid var(--border);
    border-radius: 10px; padding: 8px 16px; font-family: 'DM Sans', sans-serif;
    font-size: 13px; cursor: pointer; transition: all 0.15s;
  }
  .btn-ghost:hover { border-color: var(--blue); color: var(--blue); }

  .badge-ok  { background: var(--green-light); color: #007a5e; border-radius: 20px; padding: 4px 12px; font-size: 12px; font-weight: 700; display: inline-flex; align-items: center; gap: 4px; }
  .badge-warn{ background: #fff8e6; color: #997000; border-radius: 20px; padding: 4px 12px; font-size: 12px; font-weight: 700; display: inline-flex; align-items: center; gap: 4px; }
  .badge-bad { background: #fde8e8; color: #a81c1c; border-radius: 20px; padding: 4px 12px; font-size: 12px; font-weight: 700; display: inline-flex; align-items: center; gap: 4px; }

  .meeting-row { border-bottom: 1px solid var(--border); transition: background 0.15s; }
  .meeting-row:last-child { border-bottom: none; }
  .meeting-row:hover { background: var(--bg); }

  .time-big { font-family: 'DM Sans', sans-serif; font-weight: 700; font-size: 28px; color: var(--blue); line-height: 1; letter-spacing: -0.02em; }

  .suggestion-card { border-radius: 10px; padding: 12px 14px; margin-top: 10px; font-size: 13.5px; line-height: 1.5; }
  .suggestion-card.good { background: var(--green-light); border-left: 3px solid var(--green); }
  .suggestion-card.warn { background: #fff8e6; border-left: 3px solid #e6a800; }
  .suggestion-card.bad  { background: #fde8e8; border-left: 3px solid #c02a2a; }

  .modal-overlay {
    position: fixed; inset: 0; background: rgba(0,18,64,0.5); backdrop-filter: blur(5px);
    z-index: 50; display: flex; align-items: center; justify-content: center; padding: 20px;
    opacity: 0; pointer-events: none; transition: opacity 0.2s;
  }
  .modal-overlay.open { opacity: 1; pointer-events: all; }
  .modal {
    background: var(--surface); border-radius: 22px; width: 100%; max-width: 520px;
    max-height: 90vh; overflow-y: auto; box-shadow: 0 24px 70px rgba(0,34,131,0.2);
    transform: translateY(16px); transition: transform 0.22s;
  }
  .modal-overlay.open .modal { transform: translateY(0); }

  @keyframes slideIn { from { opacity:0; transform: translateY(10px); } to { opacity:1; transform: translateY(0); } }
  .animate-in { animation: slideIn 0.28s ease forwards; }

  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

  .header-stripe { height: 4px; background: linear-gradient(90deg, var(--green) 0%, var(--blue) 100%); }

  .watermark {
    font-family: 'Charm', cursive;
    font-size: 12px;
    color: rgba(0,34,131,0.16);
    text-align: center;
    padding: 16px 0 12px;
    pointer-events: none;
    user-select: none;
  }
</style>
</head>
<body>

<div class="header-stripe"></div>

<header style="background: var(--blue);">
  <div class="max-w-3xl mx-auto px-6 py-5 flex items-center justify-between">
    <div>
      <h1 style="font-size: 22px; color: var(--white); display:flex; align-items:baseline; gap: 8px;">
        <span class="font-brand">Mis</span>
        <span class="font-secondary" style="color: var(--green); font-size: 26px; line-height:1;">reuniones</span>
      </h1>
      <p style="font-size: 12px; color: rgba(255,255,255,0.5); margin-top: 3px;">
        Todo en hora de Espa√±a &nbsp;¬∑&nbsp; <span id="current-time"></span>
      </p>
    </div>
    <button class="btn-primary" onclick="openModal()">+ Nueva reuni√≥n</button>
  </div>
</header>

<main class="max-w-3xl mx-auto px-6 py-8">
  <div id="empty-state" class="card text-center py-16 px-8" style="display:none;">
    <div style="font-size:44px; margin-bottom:14px;">üåç</div>
    <h2 class="font-brand" style="font-size:20px; color:var(--blue); margin-bottom:8px;">Sin reuniones todav√≠a</h2>
    <p style="color:var(--muted); font-size:14px; max-width:320px; margin:0 auto 22px; line-height:1.6;">
      A√±ade una reuni√≥n con la hora de tu cliente y ver√°s cu√°ndo es en Espa√±a autom√°ticamente.
    </p>
    <button class="btn-primary" onclick="openModal()">A√±adir primera reuni√≥n</button>
  </div>
  <div id="meetings-container"></div>
</main>

<div class="watermark">Hecho por Norah :)</div>

<!-- MODAL -->
<div class="modal-overlay" id="modal-overlay" onclick="closeModalOnBg(event)">
  <div class="modal">
    <div class="px-7 py-6">
      <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:22px;">
        <h2 class="font-brand" style="font-size:20px; color:var(--blue); display:flex; align-items:baseline; gap:6px;">
          Nueva
          <span class="font-secondary" style="color:var(--green); font-size:24px;">reuni√≥n</span>
        </h2>
        <button onclick="closeModal()" style="background:none;border:none;cursor:pointer;color:var(--muted);font-size:24px;line-height:1;padding:0 4px;">√ó</button>
      </div>

      <div style="display:grid; gap:18px;">
        <div>
          <label>T√≠tulo de la reuni√≥n</label>
          <input type="text" id="f-title" placeholder="Ej: Call con cliente de M√©xico">
        </div>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
          <div>
            <label>Pa√≠s / zona horaria del cliente</label>
            <select id="f-country"><option value="">‚Äî Selecciona ‚Äî</option></select>
          </div>
          <div>
            <label>Fecha de la reuni√≥n</label>
            <input type="date" id="f-date">
          </div>
        </div>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
          <div>
            <label>Hora seg√∫n el cliente</label>
            <input type="time" id="f-time">
          </div>
          <div>
            <label>Duraci√≥n</label>
            <select id="f-duration">
              <option value="30">30 minutos</option>
              <option value="45">45 minutos</option>
              <option value="60" selected>1 hora</option>
              <option value="90">1h 30min</option>
              <option value="120">2 horas</option>
            </select>
          </div>
        </div>
        <div>
          <label>Notas (opcional)</label>
          <input type="text" id="f-notes" placeholder="Ej: Traer propuesta de precios">
        </div>
        <div id="conversion-preview" style="display:none;"></div>
      </div>

      <div class="flex gap-3 mt-7">
        <button class="btn-ghost" onclick="closeModal()" style="flex:1;">Cancelar</button>
        <button class="btn-primary" onclick="saveMeeting()" style="flex:2;">Guardar reuni√≥n</button>
      </div>
    </div>
  </div>
</div>

<script>
const COUNTRIES = [
  { label:"Argentina", tz:"America/Argentina/Buenos_Aires" },
  { label:"Australia (S√≠dney)", tz:"Australia/Sydney" },
  { label:"Australia (Melbourne)", tz:"Australia/Melbourne" },
  { label:"Brasil (S√£o Paulo)", tz:"America/Sao_Paulo" },
  { label:"Canad√° (Toronto)", tz:"America/Toronto" },
  { label:"Canad√° (Vancouver)", tz:"America/Vancouver" },
  { label:"Chile", tz:"America/Santiago" },
  { label:"China", tz:"Asia/Shanghai" },
  { label:"Colombia", tz:"America/Bogota" },
  { label:"Corea del Sur", tz:"Asia/Seoul" },
  { label:"Dubai / EAU", tz:"Asia/Dubai" },
  { label:"Ecuador", tz:"America/Guayaquil" },
  { label:"EE.UU. (Nueva York)", tz:"America/New_York" },
  { label:"EE.UU. (Chicago)", tz:"America/Chicago" },
  { label:"EE.UU. (Denver)", tz:"America/Denver" },
  { label:"EE.UU. (Los √Ångeles)", tz:"America/Los_Angeles" },
  { label:"Francia", tz:"Europe/Paris" },
  { label:"Alemania", tz:"Europe/Berlin" },
  { label:"Italia", tz:"Europe/Rome" },
  { label:"India", tz:"Asia/Kolkata" },
  { label:"Jap√≥n", tz:"Asia/Tokyo" },
  { label:"M√©xico", tz:"America/Mexico_City" },
  { label:"Pa√≠ses Bajos", tz:"Europe/Amsterdam" },
  { label:"Per√∫", tz:"America/Lima" },
  { label:"Polonia", tz:"Europe/Warsaw" },
  { label:"Portugal", tz:"Europe/Lisbon" },
  { label:"Reino Unido", tz:"Europe/London" },
  { label:"Rusia (Mosc√∫)", tz:"Europe/Moscow" },
  { label:"Singapur", tz:"Asia/Singapore" },
  { label:"Sud√°frica", tz:"Africa/Johannesburg" },
  { label:"Suecia", tz:"Europe/Stockholm" },
  { label:"Suiza", tz:"Europe/Zurich" },
  { label:"Uruguay", tz:"America/Montevideo" },
  { label:"Venezuela", tz:"America/Caracas" },
];
const SPAIN_TZ = "Europe/Madrid";

const sel = document.getElementById('f-country');
[...COUNTRIES].sort((a,b)=>a.label.localeCompare(b.label)).forEach(c=>{
  const o=document.createElement('option'); o.value=c.tz; o.textContent=c.label; sel.appendChild(o);
});

function updateClock(){
  const now=new Date();
  const t=now.toLocaleTimeString('es-ES',{timeZone:SPAIN_TZ,hour:'2-digit',minute:'2-digit'});
  const d=now.toLocaleDateString('es-ES',{timeZone:SPAIN_TZ,weekday:'long',day:'numeric',month:'long'});
  document.getElementById('current-time').textContent=`${d}, ${t}`;
}
updateClock(); setInterval(updateClock,10000);
document.getElementById('f-date').value=new Date().toISOString().split('T')[0];

['f-country','f-date','f-time'].forEach(id=>{
  document.getElementById(id).addEventListener('change',updatePreview);
  document.getElementById(id).addEventListener('input',updatePreview);
});

function updatePreview(){
  const tz=document.getElementById('f-country').value;
  const date=document.getElementById('f-date').value;
  const time=document.getElementById('f-time').value;
  const preview=document.getElementById('conversion-preview');
  if(!tz||!date||!time){preview.style.display='none';return;}
  const c=convertTime(tz,date,time);
  if(!c){preview.style.display='none';return;}
  const comfort=getComfortLevel(c.spainHour);
  preview.style.display='block';
  preview.innerHTML=`
    <div style="background:var(--blue-light);border-radius:12px;padding:16px;border:1.5px solid var(--border);">
      <div style="font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.08em;color:var(--muted);margin-bottom:10px;">Vista previa ¬∑ Hora en Espa√±a</div>
      <div style="display:flex;align-items:center;gap:16px;">
        <div>
          <div class="time-big">${c.spainTime}</div>
          <div style="font-size:12px;color:var(--muted);margin-top:3px;">${c.spainDate}</div>
        </div>
        <div style="color:var(--border);font-size:20px;">‚Üí</div>
        <div>${comfort.badge}</div>
      </div>
      <div class="suggestion-card ${comfort.cls}">${comfort.message}</div>
    </div>`;
}

function getOffset(tz,refDate){
  const d=typeof refDate==='string'?new Date(refDate):refDate;
  const u=d.toLocaleString('sv-SE',{timeZone:'UTC'});
  const z=d.toLocaleString('sv-SE',{timeZone:tz});
  return (new Date(z)-new Date(u))/60000;
}

function convertTime(fromTz,date,time){
  try{
    const s=`${date}T${time}:00`;
    const co=getOffset(fromTz,s+'Z');
    const so=getOffset(SPAIN_TZ,s+'Z');
    const [h,m]=time.split(':').map(Number);
    let sm=h*60+m+(so-co);
    let dy=0;
    if(sm<0){sm+=1440;dy=-1;} if(sm>=1440){sm-=1440;dy=1;}
    const sh=Math.floor(sm/60), mm=sm%60;
    const st=`${String(sh).padStart(2,'0')}:${String(mm).padStart(2,'0')}`;
    const sd=new Date(date+'T00:00:00'); sd.setDate(sd.getDate()+dy);
    const sdStr=sd.toLocaleDateString('es-ES',{weekday:'long',day:'numeric',month:'long'});
    return{spainTime:st,spainDate:sdStr,spainHour:sh};
  }catch{return null;}
}

function getComfortLevel(h){
  if(h>=9&&h<13)  return{cls:'good',badge:'<span class="badge-ok">‚úì Hora ideal</span>',      message:'‚úÖ <strong>¬°Perfecto!</strong> Plena ma√±ana laboral. Momento excelente para la reuni√≥n.'};
  if(h>=13&&h<14) return{cls:'good',badge:'<span class="badge-ok">‚úì Buena hora</span>',       message:'üëç <strong>Buena hora.</strong> Justo antes de comer, todav√≠a en jornada laboral.'};
  if(h>=14&&h<15) return{cls:'warn',badge:'<span class="badge-warn">~ Hora de comer</span>',  message:'üçΩÔ∏è <strong>Puede ser inc√≥modo.</strong> Es la hora de comer en Espa√±a. Tenlo en cuenta.'};
  if(h>=15&&h<18) return{cls:'good',badge:'<span class="badge-ok">‚úì Buena tarde</span>',      message:'‚òÄÔ∏è <strong>Tarde laboral.</strong> Hora razonable dentro del horario habitual.'};
  if(h>=18&&h<20) return{cls:'warn',badge:'<span class="badge-warn">~ Fin de jornada</span>', message:'üåÜ <strong>Final del d√≠a.</strong> Saliendo del horario habitual. ¬øPuedes proponer otra franja?'};
  if(h>=20||h<8)  return{cls:'bad', badge:'<span class="badge-bad">‚úó Fuera de horario</span>',message:'üåô <strong>Hora muy inc√≥moda.</strong> Fuera del horario laboral. Negocia otro hueco con el cliente.'};
  return{cls:'warn',badge:'<span class="badge-warn">~ Muy temprano</span>',message:'‚òï <strong>Primera hora del d√≠a.</strong> Puede ser muy temprano. Valora si te encaja.'};
}

function openModal(){document.getElementById('modal-overlay').classList.add('open');setTimeout(()=>document.getElementById('f-title').focus(),100);}
function closeModal(){document.getElementById('modal-overlay').classList.remove('open');document.getElementById('conversion-preview').style.display='none';}
function closeModalOnBg(e){if(e.target===document.getElementById('modal-overlay'))closeModal();}

function saveMeeting(){
  const title=document.getElementById('f-title').value.trim();
  const tz=document.getElementById('f-country').value;
  const date=document.getElementById('f-date').value;
  const time=document.getElementById('f-time').value;
  const duration=document.getElementById('f-duration').value;
  const notes=document.getElementById('f-notes').value.trim();
  if(!title||!tz||!date||!time){alert('Por favor rellena todos los campos obligatorios.');return;}
  const countryName=COUNTRIES.find(c=>c.tz===tz)?.label||tz;
  const conv=convertTime(tz,date,time);
  const meeting={id:Date.now(),title,tz,countryName,date,time,duration,notes,
    spainTime:conv?.spainTime,spainDate:conv?.spainDate,spainHour:conv?.spainHour};
  const meetings=getMeetings();
  meetings.push(meeting);
  meetings.sort((a,b)=>(a.date+a.spainTime).localeCompare(b.date+b.spainTime));
  saveMeetings(meetings);
  ['f-title','f-notes'].forEach(id=>document.getElementById(id).value='');
  document.getElementById('f-country').value='';
  document.getElementById('f-time').value='';
  document.getElementById('f-date').value=new Date().toISOString().split('T')[0];
  document.getElementById('conversion-preview').style.display='none';
  closeModal(); renderMeetings();
}

function getMeetings(){try{return JSON.parse(localStorage.getItem('reuniones')||'[]');}catch{return[];}}
function saveMeetings(m){localStorage.setItem('reuniones',JSON.stringify(m));}
function deleteMeeting(id){
  if(!confirm('¬øEliminar esta reuni√≥n?'))return;
  saveMeetings(getMeetings().filter(m=>m.id!==id)); renderMeetings();
}

function renderMeetings(){
  const meetings=getMeetings();
  const container=document.getElementById('meetings-container');
  const empty=document.getElementById('empty-state');
  if(meetings.length===0){empty.style.display='block';container.innerHTML='';return;}
  empty.style.display='none';
  const groups={};
  meetings.forEach(m=>{const k=m.spainDate||m.date;if(!groups[k])groups[k]=[];groups[k].push(m);});
  container.innerHTML='';
  Object.entries(groups).forEach(([label,group])=>{
    const s=document.createElement('div'); s.className='mb-6 animate-in';
    s.innerHTML=`
      <div style="font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.09em;color:var(--muted);margin-bottom:10px;padding-left:2px;">${label}</div>
      <div class="card" style="overflow:hidden;">${group.map(renderRow).join('')}</div>`;
    container.appendChild(s);
  });
}

function renderRow(m){
  const comfort=m.spainHour!=null?getComfortLevel(m.spainHour):null;
  const dl={30:'30 min',45:'45 min',60:'1h',90:'1h 30min',120:'2h'}[m.duration]||`${m.duration} min`;
  return `
    <div class="meeting-row" style="padding:16px 20px;display:flex;align-items:center;gap:16px;">
      <div style="flex:0 0 96px;text-align:center;border-right:1.5px solid var(--border);padding-right:16px;">
        <div class="time-big">${m.spainTime||'‚Äî'}</div>
        <div style="font-size:11px;color:var(--muted);margin-top:4px;font-weight:700;letter-spacing:.04em;text-transform:uppercase;">Espa√±a</div>
      </div>
      <div style="flex:1;min-width:0;">
        <div class="font-brand" style="font-size:15px;margin-bottom:4px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${m.title}</div>
        <div style="font-size:12px;color:var(--muted);">üåç ${m.countryName} &nbsp;¬∑&nbsp; ${m.time} &nbsp;¬∑&nbsp; ${dl}${m.notes?` &nbsp;¬∑&nbsp; <em>${m.notes}</em>`:''}</div>
      </div>
      <div style="flex:0 0 auto;display:flex;flex-direction:column;align-items:flex-end;gap:8px;">
        ${comfort?comfort.badge:''}
        <button onclick="deleteMeeting(${m.id})" class="btn-ghost" style="padding:4px 10px;font-size:12px;">Eliminar</button>
      </div>
    </div>`;
}

renderMeetings();
</script>
</body>
</html>
